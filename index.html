<html>

<head>
    <style>
        .norns {
        background-color: #AAA9AD;
        width: 1050px;
        height:600px;
    }

    .k1 {
    	position: absolute;
    	left:95px;
    	top:125px;
    }   
     .k2 {
    	position: absolute;
    	left:700px;
    	top:475px;
    }    
    .k3 {
    	position: absolute;
    	left:855px;
    	top:475px;
    }

.button {

  width:60px;
  height:60px;
  font-size: 24px;
  text-align: center;
  cursor: pointer;
  outline: none;
  color: #fff;
  background-color: #222222;
  border: none;
   border-radius: 50%;
  box-shadow: 0 9px #999;
}


.button:active {
  box-shadow: 0 5px #666;
  transform: translateY(4px);
}

    .nornsimage {
    	position:absolute;
    	left:60px;
    	top:250px;
    	    }

    	    .enc1knob {
    	    	  	position:absolute;
    	left:200px;
    	top:100px;

    	    }
    	    .enc2knob {
    	    	  	position:absolute;
    	left:750px;
    	top:300px;
    	    }

    	    .enc3knob {
    	    	  	position:absolute;
    	left:905px;
    	top:300px;
    	    }
    </style>
</head>

<body>
    <div class="norns">
        <img src="https://duct.schollz.com/a.png" class="nornsimage" id="nornsimage" style="width:600px" ;>
        <button class="button k1" id="k1"></button>
        <button class="button k2" id="k2"></button>
        <button class="button k3" id="k3"></button>
        <div class="enc1knob">
            <input type="text" value="75" class="enc1" data-width="100" data-displayInput=false data-cursor=true data-fgColor="#fff" data-bgColor="#222222" data-thickness=1 data-curosr=1>
        </div>
        <div class="enc2knob">
            <input type="text" value="75" class="enc2" data-width="100" data-displayInput=false data-cursor=true data-fgColor="#fff" data-bgColor="#222222" data-thickness=1 data-curosr=1>
        </div>
        <div class="enc3knob">
            <input type="text" value="75" class="enc3" data-width="100" data-displayInput=false data-cursor=true data-fgColor="#fff" data-bgColor="#222222" data-thickness=1 data-curosr=1>
        </div>
    </div>
    <script>
    setInterval(function() {
        var myImageElement = document.getElementById('nornsimage');
        myImageElement.src = 'https://duct.schollz.com/a.png?rand=' + Math.random();
    }, 250);
    </script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="http://anthonyterrien.com/demo/knob/jquery.knob.min.js"></script>
    <script>
    function debounce(func, wait, immediate) {
        var timeout;
        return function() {
            var context = this,
                args = arguments;
            var later = function() {
                timeout = null;
                if (!immediate) func.apply(context, args);
            };
            var callNow = immediate && !timeout;
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
            if (callNow) func.apply(context, args);
        };
    };

    function sendCommand(command) {
        // Old compatibility code, no longer needed.
        if (window.XMLHttpRequest) { // Mozilla, Safari, IE7+ ...
            httpRequest = new XMLHttpRequest();
        } else if (window.ActiveXObject) { // IE 6 and older
            httpRequest = new ActiveXObject("Microsoft.XMLHTTP");
        }
        httpRequest.open('GET', 'https://duct.schollz.com/b?pubsub=true&body=' + command, true);
        httpRequest.send();
    }

    function currentTime() {
        return (new Date()).getTime();
    }

    enc2_last_value = 0;
    enc2_last_time = (new Date()).getTime();

    function enc2(v) {
        if (currentTime() - enc2_last_time < 200) {
            return
        }
        console.log(v)
        enc2_last_time = currentTime()
        increased = v > enc2_last_value
        if (Math.abs(enc2_last_value - v) > 50) {
            increased = !increased;
        }
        if (increased) {
            sendCommand('enc(2,1)')
        } else {
            sendCommand('enc(2,-1)')
        }
        enc2_last_value = v;
    }


    document.getElementById("k1").addEventListener("click", function() {
        sendCommand('key(1,1)')
    });

    document.getElementById("k2").addEventListener("click", function() {
        sendCommand('key(2,1)')
    });

    document.getElementById("k3").addEventListener("click", function() {
        sendCommand('key(3,1)')
    });

    $(".enc1").knob({});
    $(".enc2").knob({
        'change': enc2,
    });
    $(".enc3").knob({});
    </script>
</body>

</html>
